<html lang="en">
<headTech>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tech</title>
    <link rel="stylesheet" href="styles.css">
</headTech>
<body>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

<div>
  <div id="Logo">
      <img src="Logo.png" width="120px" height="120px">
      <p style="margin-top: -20px;font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;">صنايعي</p>
  </div>
  <div id="User">
      <img src="user.png" width="100px" height="100px">
      <p id="username" style="margin-top: -15px;"></p>
  </div>
<img id="imgheadTech" src="back.png">
</div>

<h2>طلبات العملاء الخاصه بك</h2>
<p>استعراض تفاصيل طلباتك</p>

<div id="work">
    <h3>كل الطلبات</h3>
</div>
<!-- <div id="allOrders"></div> -->
<div id="parent-2">
  <div class="tab" dir="rtl">
  <button class="tablinksTec" onclick="openTapTech(event, 'allOrdersTec')">كل الطلبات</button>
  <button class="tablinksTec" onclick="openTapTech(event, 'ordersApprovedTec')">الطلبات تمت الموافقه عليها</button>
</div>
<div id="allOrdersTec" class="tabcontentTec">
  <br>
</div>

<div id="ordersApprovedTec" class="tabcontentTec">
  <br>
</div>

  <p></p>
  <script>
    var currentLoginUser = sessionStorage.getItem('currenLoginUser')
    document.getElementById("username").innerText = currentLoginUser;
    
    function openTapTech(evt, orderType) {
      var i, tabcontentTec, tablinksTec;
      tabcontentTec = document.getElementsByClassName("tabcontentTec");
      for (i = 0; i < tabcontentTec.length; i++) {
        tabcontentTec[i].style.display = "none";
      }
      tablinksTec = document.getElementsByClassName("tablinksTec");
      for (i = 0; i < tablinksTec.length; i++) {
        tablinksTec[i].className = tablinksTec[i].className.replace(" active", "");
      }
      document.getElementById(orderType).style.display = "block";
      evt.currentTarget.className += " active";
    }



var headTech = [
    "رقم الطلب",
    "العميل",
    "التليفون",
    "محافظه",
    "منطقه",
    "تاريخ الطلب",
    "تاريخ الصيانه",
    "وصف المشكله",
]

// var dataObj = [
// {
//   "orderNumber": "00001", 
//   "customer": "ahmed customer",
//   "phone": "010056456464", 
//   "governent": "giza",
//   "area": "haram",
//   "address": "shaaban shalaby - haram - giza",
//   "orderDate": "01-12-2017",
//   "discription": "مشكله عويصه جدا جدا جدا وتلاجه بايظه وخربانه",

// },{
//     "orderNumber": "00002", 
//     "customer": "ahmed customer",
//   "phone": "010056456464", 
//   "governent": "giza",
//   "area": "haram",
//   "address": "shaaban shalaby - haram - giza",
//   "orderDate": "01-12-2017",
//   "discription": "مشكله عويصه جدا جدا جدا وتلاجه بايظه وخربانه",

// },{
//     "orderNumber": "00003", 
//     "customer": "mohamed customer",
//   "phone": "010056456464", 
//   "governent": "giza",
//   "area": "haram",
//   "address": "shaaban shalaby - haram - giza",
//   "orderDate": "01-12-2017",
//   "discription": " مشكله عويصه جدا جدا جدا وتلاجه بايظه وخربانه وبايظه وخربانه وبايظه وهيييييه ويلاااا ويلا بينا يا سطر يلا يبينا يلا بينا وهييييييييييه ويلا بينا هيييييييييييييه وسطر كمان عشا نالحبايب وكمان سطر عشان حبايب الحبايب",
// }
// ];

  var xmlhttp = new XMLHttpRequest();
  xmlhttp.onreadystatechange = function() {
  if (this.readyState == 4 && this.status == 200) {
    var data = JSON.parse(xmlhttp.responseText);

   for(i = 0; i < data.length; i++)
   {
      // if(myData[i].status != "rejected")
        Func(data, headTech, i)
   }
  }
};

xmlhttp.open("GET", "http://m0stafaeladawy01.pythonanywhere.com/ClientsOrder/", true);
xmlhttp.send();


function Func(data, headTech, i)
{
  var tdheadTechStyle = 'style="background-color: #4CAF50; color: white; text-align: center; height: 50px; width: 50px;  border: solid 2px; white"';
  var tdDataStyle = 'style="text-align: center; height: 50px; width: 200px;"';
  var buttonStyle = 'style="background-color: #4CAF50; border: none; color: white; padding: 15px 32px; text-align: center; text-decoration: none; display: inline-block; font-size: 16px; margin: 4px 2px; cursor: pointer; width: 260px;"';
  var templateString =
    '<table style="border: 3px solid grey;" dir="rtl" align="center" class="tableCard">'
    + '<tr>'
    + '<td ' + tdheadTechStyle +'>' + headTech[0] + '</td>' 
    + '<td ' + tdDataStyle + '>' +data[i].id+'</td>'

    + '<td ' + tdheadTechStyle +'>' + headTech[1] + '</td>' 
    + '<td ' + tdDataStyle + '>' +data[i].cus_name+'</td>'

    + '<td ' + tdheadTechStyle +'>' + headTech[2] + '</td>' 
    + '<td ' + tdDataStyle + '>' +data[i].cus_phone+'</td>'
    + '<td></td>'
    + '</tr>' 
    

    + '<tr>'
    + '<td ' + tdheadTechStyle +'>' + headTech[3] + '</td>' 
    + '<td ' + tdDataStyle + '>' +data[i].o_governorate+'</td>'

    + '<td ' + tdheadTechStyle +'>' + headTech[4] + '</td>' 
    + '<td ' + tdDataStyle + '>' +data[i].o_region+'</td>'

    + '<td ' + tdheadTechStyle +'>' + headTech[5] + '</td>' 
    + '<td ' + tdDataStyle + '>' +data[i].o_date+'</td>'

    + '<td ></td>' 
    + '</tr>' 


    + '<tr>'
    + '<td  ' + tdheadTechStyle +'>' + headTech[6] + '</td>' 
    + '<td ' + tdDataStyle + ' colspan="5">' +data[i].o_excute_date+'</td>'
    + '<td><button style="background-color: #4CAF50; border: none; color: white; padding: 15px 32px; text-align: center; text-decoration: none; display: inline-block; font-size: 26px; margin: 4px 2px; cursor: pointer;  width: 260px;" onclick="orderAccept(i)">الموافقه على الطلب</button></td>'
    + '</tr>' 
    

    + '<tr>'
    + '<td  ' + tdheadTechStyle +'>' + headTech[7] + '</td>' 
    + '<td ' + tdDataStyle + 'colspan="5">' +data[i].o_desc+'</td>'
    + '<td><button style="background-color: #4CAF50; border: none; color: white; padding: 15px 32px; text-align: center; text-decoration: none; display: inline-block; font-size: 16px; margin: 4px 2px; cursor: pointer;  width: 260px;" onclick="orderRefuse(i)">رفض الطلب</button></td>'
    + '</tr>' 

    + '<tr>'
    + '<td><p><br></p>'
    + '</td>'
    + '</tr>' 


    + '</table>' + '<br>';

    var templateStringApproved = 
    '<table style="border: 3px solid grey;" dir="rtl" align="center" class="tableCard">'
    + '<tr>'
    + '<td ' + tdheadTechStyle +'>' + headTech[0] + '</td>' 
    + '<td ' + tdDataStyle + '>' +data[i].id+'</td>'

    + '<td ' + tdheadTechStyle +'>' + headTech[1] + '</td>' 
    + '<td ' + tdDataStyle + '>' +data[i].cus_name+'</td>'

    + '<td ' + tdheadTechStyle +'>' + headTech[2] + '</td>' 
    + '<td ' + tdDataStyle + '>' +data[i].cus_phone+'</td>'
    + '<td></td>'
    + '</tr>' 
    

    + '<tr>'
    + '<td ' + tdheadTechStyle +'>' + headTech[3] + '</td>' 
    + '<td ' + tdDataStyle + '>' +data[i].o_governorate+'</td>'

    + '<td ' + tdheadTechStyle +'>' + headTech[4] + '</td>' 
    + '<td ' + tdDataStyle + '>' +data[i].o_region+'</td>'

    + '<td ' + tdheadTechStyle +'>' + headTech[5] + '</td>' 
    + '<td ' + tdDataStyle + '>' +data[i].o_date+'</td>'

    + '<td ></td>' 
    + '</tr>' 


    + '<tr>'
    + '<td  ' + tdheadTechStyle +'>' + headTech[6] + '</td>' 
    + '<td ' + tdDataStyle + ' colspan="5">' +data[i].o_excute_date+'</td>'
    + '<td ></td>' 
    + '</tr>' 
    

    + '<tr>'
    + '<td  ' + tdheadTechStyle +'>' + headTech[7] + '</td>' 
    + '<td ' + tdDataStyle + 'colspan="5">' +data[i].o_desc+'</td>'
    + '<td ></td>' 
    + '</tr>' 

    + '<tr>'
    + '<td><p><br></p>'
    + '</td>'
    + '</tr>' 


    + '</table>' + '<br>';
    
    var status = data[i].o_status;
    var tecName = data[i].tech_name;
    // console.log(data[i].status)

    function allOrdersTech(status)
    {
      if(tecName == currentLoginUser)
        $('#allOrdersTec').append(templateString);
    }

    function allOrdersApprovedTech(Status)
    {
      if(Status == "معتمد" && tecName == currentLoginUser)
        $('#ordersApprovedTec').append(templateStringApproved);
    }

    allOrdersTech(status)
    allOrdersApprovedTech(status)

}
// var msg ='<br>' + 'رقم: ' + data[i].orderNumber + '<br>بإسم: ' + data[i].customer

function orderRefuse(i)
{
  // data[i].status == "rejected"
  alert("تم رفض الطلب")
}

function orderAccept(i)
{
  // data[i].status == "approved"
  alert("تم الموافقه على الطلب")
}

  </script>
</body>
</html>